# 用户连接监控功能说明

## 功能概述

实现了子机连接信息自动上报到母机的功能。当子机成功连接到任何SSH服务器时，会自动将连接信息（IP、端口、用户名、密码、授权码ID、机器ID）发送到母机服务器，母机可以在界面上查看所有用户的连接记录。

## 功能特点

### 母机（授权服务器）

1. **HTTP服务器**
   - 自动启动HTTP服务器，监听端口：8888
   - 接收子机发送的连接信息
   - 服务器地址显示在"用户连接信息"标签页中

2. **用户连接信息显示**
   - 新增"用户连接信息"标签页
   - 显示所有子机的连接记录
   - 包含以下信息：
     - 连接时间
     - IP地址
     - 端口
     - 用户名
     - 密码
     - 授权码ID（12位）
     - 机器ID

3. **数据存储**
   - 连接信息保存在 `user_connections.json` 文件中
   - 自动去重（相同IP、端口、用户名的连接会更新记录）
   - 按连接时间倒序排列

### 子机（客户端）

1. **自动上报**
   - 每次成功连接SSH服务器后，自动发送连接信息到母机
   - 静默发送，不影响用户体验
   - 如果母机服务器不可达，静默失败（不显示错误）

2. **上报信息**
   - IP地址
   - 端口
   - 用户名
   - 密码
   - 机器ID（自动获取）
   - 授权码ID（自动获取）

3. **服务器地址配置**
   - 默认服务器地址：`http://localhost:8888`
   - 可通过配置文件 `client_config.json` 修改服务器地址
   - 配置文件格式：
     ```json
     {
       "server_url": "http://192.168.1.100:8888"
     }
     ```

## 使用说明

### 母机使用

1. 启动母机程序
2. 程序会自动启动HTTP服务器（端口8888）
3. 切换到"用户连接信息"标签页查看连接记录
4. 服务器地址显示在界面顶部

### 子机使用

1. 确保子机能够访问母机服务器（如果是不同机器，需要配置服务器地址）
2. 正常使用子机连接SSH服务器
3. 连接成功后，连接信息会自动发送到母机
4. 如需修改服务器地址，编辑 `client_config.json` 文件

## 配置文件

### 母机配置文件

- `user_connections.json` - 用户连接记录（自动生成）

### 子机配置文件

- `client_config.json` - 服务器地址配置（可选，默认使用 localhost:8888）

## 注意事项

1. **网络要求**
   - 子机需要能够访问母机的IP地址和端口8888
   - 如果母机和子机不在同一台机器上，需要配置防火墙允许8888端口

2. **安全性**
   - 连接信息（包括密码）会以明文形式发送到母机
   - 建议在安全的网络环境中使用
   - 母机服务器只监听本地网络，不对外暴露

3. **服务器地址配置**
   - 如果母机和子机在同一台机器上，使用默认地址即可
   - 如果不在同一台机器上，需要修改子机的 `client_config.json` 文件

## 技术实现

- **服务器端**：使用Python内置的 `http.server` 模块
- **客户端**：使用 `urllib.request` 发送HTTP POST请求
- **数据格式**：JSON格式
- **通信协议**：HTTP POST

## 故障排除

1. **子机无法发送连接信息**
   - 检查母机服务器是否运行
   - 检查网络连接
   - 检查防火墙设置
   - 检查服务器地址配置

2. **母机无法接收连接信息**
   - 检查端口8888是否被占用
   - 检查防火墙设置
   - 查看程序日志

3. **连接信息不显示**
   - 点击"刷新列表"按钮
   - 检查 `user_connections.json` 文件是否存在
   - 检查文件权限


























































