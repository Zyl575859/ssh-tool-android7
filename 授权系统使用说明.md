# 授权系统使用说明

## 概述

本工具采用主从架构，包含：
- **母机（授权服务器）**：生成和管理授权码
- **子机（客户端）**：需要授权码才能使用

## 文件说明

### 母机程序
- `license_server_gui.py` - 授权服务器GUI程序
- `license_manager.py` - 授权管理模块（核心）
- `build_license_server.bat` - 母机打包脚本
- `license_server_gui.spec` - 母机打包配置文件

### 子机程序
- `ssh_tool_gui.py` - GM工具客户端程序（已集成授权验证）
- `license_manager.py` - 授权管理模块（核心）
- `build_client.bat` - 子机打包脚本
- `ssh_tool_gui_client.spec` - 子机打包配置文件

## 使用流程

### 1. 打包程序

#### 打包母机
```bash
build_license_server.bat
```
生成：`dist\流浪GM工具-授权服务器（母机）.exe`

#### 打包子机
```bash
build_client.bat
```
生成：`dist\流浪GM工具v1.0.1豪华版（子机）.exe`

### 2. 使用母机生成授权码

1. 运行 `流浪GM工具-授权服务器（母机）.exe`
2. 选择有效期：
   - 1分钟
   - 1小时
   - 1天
   - 7天
   - 30天
   - 永久
3. 点击"生成授权码"
4. 复制生成的授权码
5. 将授权码发送给需要使用子机的用户

### 3. 使用子机（需要授权码）

1. 运行 `流浪GM工具v1.0.1豪华版（子机）.exe`
2. 如果没有授权码，程序会弹出授权验证对话框
3. 输入授权码，点击"验证授权"
4. 授权验证成功后，可以使用GM工具

### 4. 管理授权码（母机）

#### 查看授权码列表
- 在母机程序中查看所有已生成的授权码
- 显示信息：授权码ID、有效期、创建时间、过期时间、状态、是否已使用、使用时间

#### 停用授权码
1. 在授权码列表中选择要停用的授权码
2. 点击"停用选中"
3. 确认停用操作
4. 停用后，该授权码将无法在子机上使用

## 授权码格式

授权码是Base64编码的JSON字符串，包含：
- `id`: 授权码唯一标识
- `duration_type`: 有效期类型
- `duration`: 有效期（秒）
- `create_time`: 创建时间
- `expire_time`: 过期时间（时间戳，-1表示永久）
- `expire_str`: 过期时间（字符串）
- `status`: 状态（active/revoked）
- `signature`: 签名（防止篡改）

## 授权验证机制

1. **签名验证**：验证授权码是否被篡改
2. **状态检查**：检查授权码是否被停用
3. **过期检查**：检查授权码是否过期
4. **列表验证**：验证授权码是否在母机的授权列表中

## 文件存储

### 母机
- `licenses.json` - 授权码列表（保存在exe同目录）

### 子机
- `license.key` - 授权码文件（保存在exe同目录）
- `connections.json` - SSH连接记录
- `gm_templates.json` - GM命令模板
- `item_ids.json` - 物品ID历史

## 注意事项

1. **母机安全**：
   - 母机程序应妥善保管，防止未授权生成授权码
   - `licenses.json` 文件包含所有授权码信息，应定期备份

2. **授权码安全**：
   - 授权码包含签名，无法被篡改
   - 停用授权码后，子机无法继续使用
   - 授权码过期后，子机无法继续使用

3. **子机使用**：
   - 首次使用需要输入授权码
   - 授权码验证成功后，会保存到 `license.key` 文件
   - 每次启动程序时，会自动验证授权码
   - 如果授权码无效、过期或被停用，程序将无法启动

4. **有效期说明**：
   - 1分钟：用于测试
   - 1小时：短期使用
   - 1天：日常使用
   - 7天：一周使用
   - 30天：长期使用
   - 永久：永久有效（谨慎使用）

## 故障排除

### 子机无法启动
1. 检查是否有授权码文件（`license.key`）
2. 检查授权码是否过期
3. 检查授权码是否被停用
4. 联系管理员重新生成授权码

### 授权码验证失败
1. 检查授权码是否完整（可能复制时缺少部分内容）
2. 检查授权码是否在母机的授权列表中
3. 检查授权码是否被停用
4. 检查系统时间是否正确

### 母机无法生成授权码
1. 检查程序是否有写入权限
2. 检查 `licenses.json` 文件是否被占用
3. 重启程序重试

## 技术说明

### 授权码加密
- 使用XOR加密 + Base64编码
- 使用SHA256哈希生成签名
- 密钥内置在程序中，不存储在配置文件中

### 授权验证流程
1. 解码授权码（Base64）
2. 验证签名（SHA256）
3. 检查授权码是否在列表中
4. 检查授权码状态（active/revoked）
5. 检查授权码是否过期
6. 保存授权码到子机文件

## 更新日志

### v1.0.0
- 初始版本
- 支持生成授权码（1分钟/1小时/1天/7天/30天/永久）
- 支持授权码验证
- 支持授权码停用
- 支持授权码列表管理


























































